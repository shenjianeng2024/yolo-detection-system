# YOLOæ£€æµ‹ç³»ç»Ÿ - Rustå®ç°æ–¹æ¡ˆ

## ğŸ“‹ å®ç°ç°çŠ¶

### âœ… å·²å®ç°åŠŸèƒ½
- **YOLOæ¨¡å‹æ¨ç†**ï¼šåŸºäºCandleæ¡†æ¶çš„YOLOv8æ¨¡å‹åŠ è½½å’Œæ¨ç†
- **å›¾ç‰‡æ£€æµ‹**ï¼šå®Œæ•´çš„å•å¼ å›¾ç‰‡æ£€æµ‹åŠŸèƒ½
- **å‚æ•°æ§åˆ¶**ï¼šç½®ä¿¡åº¦é˜ˆå€¼è°ƒèŠ‚ã€ç±»åˆ«é€‰æ‹©
- **Taurié›†æˆ**ï¼šå®Œæ•´çš„å‰åç«¯APIæ¥å£
- **å¼‚æ­¥å¤„ç†**ï¼šåŸºäºTokioçš„å¼‚æ­¥æ¶æ„
- **æ¡ä»¶ç¼–è¯‘**ï¼šæ”¯æŒæœ‰/æ— OpenCVçš„ç¼–è¯‘é€‰é¡¹

### âš ï¸ éƒ¨åˆ†å®ç°åŠŸèƒ½
- **æ‘„åƒå¤´æ£€æµ‹**ï¼šå·²å®ç°ä»£ç ä½†éœ€è¦OpenCVæ”¯æŒ
- **è§†é¢‘æ–‡ä»¶æ£€æµ‹**ï¼šå·²å®ç°ä»£ç ä½†éœ€è¦OpenCVæ”¯æŒ
- **å®æ—¶å¸§æµ**ï¼šå·²å®ç°ä»£ç ä½†éœ€è¦OpenCVæ”¯æŒ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶
```
src-tauri/src/yolo/
â”œâ”€â”€ detection_opencv.rs    # OpenCVç‰ˆæœ¬ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰
â”œâ”€â”€ detection_simple.rs    # ç®€åŒ–ç‰ˆæœ¬ï¼ˆçº¯Rustï¼‰
â”œâ”€â”€ model_candle.rs        # Candleæ¨ç†å¼•æ“
â”œâ”€â”€ model_stub.rs          # æ¨¡æ‹Ÿç‰ˆæœ¬ï¼ˆå¼€å‘ç”¨ï¼‰
â””â”€â”€ mod.rs                 # æ¨¡å—ç®¡ç†å’Œæ¡ä»¶ç¼–è¯‘
```

### ä¾èµ–å…³ç³»
- **æ ¸å¿ƒæ¨ç†**ï¼šCandle Frameworkï¼ˆHuggingFaceï¼‰
- **å¼‚æ­¥å¤„ç†**ï¼šTokio + futures
- **å›¾åƒå¤„ç†**ï¼šimage crate
- **è§†é¢‘å¤„ç†**ï¼šopencv-rustï¼ˆå¯é€‰ï¼‰
- **æ¡Œé¢é›†æˆ**ï¼šTauri v2

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åŸºç¡€åŠŸèƒ½ï¼ˆæ— éœ€OpenCVï¼‰
```bash
# ç¼–è¯‘åŸºç¡€ç‰ˆæœ¬ï¼ˆä»…æ”¯æŒå›¾ç‰‡æ£€æµ‹ï¼‰
cargo build --manifest-path=src-tauri/Cargo.toml

# å¯åŠ¨åº”ç”¨
pnpm tauri:dev
```

**æ”¯æŒåŠŸèƒ½**ï¼š
- âœ… å•å¼ å›¾ç‰‡æ£€æµ‹
- âœ… ç½®ä¿¡åº¦é˜ˆå€¼è°ƒèŠ‚
- âœ… æ£€æµ‹ç±»åˆ«é€‰æ‹©
- âŒ æ‘„åƒå¤´å®æ—¶æ£€æµ‹ï¼ˆæç¤ºå®‰è£…OpenCVï¼‰
- âŒ è§†é¢‘æ–‡ä»¶æ£€æµ‹ï¼ˆæç¤ºå®‰è£…OpenCVï¼‰

### 2. å®Œæ•´åŠŸèƒ½ï¼ˆéœ€è¦OpenCVï¼‰

#### macOSå®‰è£…æ­¥éª¤ï¼š
```bash
# 1. å®‰è£…OpenCV
brew install opencv

# 2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœéœ€è¦ï¼‰
export DYLD_FALLBACK_LIBRARY_PATH="$(xcode-select --print-path)/Toolchains/XcodeDefault.xctoolchain/usr/lib/"

# 3. ç¼–è¯‘å®Œæ•´ç‰ˆæœ¬
cargo build --manifest-path=src-tauri/Cargo.toml --features opencv-support

# 4. å¯åŠ¨åº”ç”¨
pnpm tauri:dev
```

#### Ubuntuå®‰è£…æ­¥éª¤ï¼š
```bash
# 1. å®‰è£…ä¾èµ–
sudo apt install libopencv-dev clang libclang-dev

# 2. ç¼–è¯‘å®Œæ•´ç‰ˆæœ¬
cargo build --manifest-path=src-tauri/Cargo.toml --features opencv-support

# 3. å¯åŠ¨åº”ç”¨
pnpm tauri:dev
```

**æ”¯æŒåŠŸèƒ½**ï¼š
- âœ… å•å¼ å›¾ç‰‡æ£€æµ‹
- âœ… æ‘„åƒå¤´å®æ—¶æ£€æµ‹ï¼ˆ30fpsï¼‰
- âœ… è§†é¢‘æ–‡ä»¶æ£€æµ‹ï¼ˆå¾ªç¯æ’­æ”¾ï¼‰
- âœ… å®æ—¶å¸§è·å–å’Œæµå¤„ç†
- âœ… ç½®ä¿¡åº¦é˜ˆå€¼è°ƒèŠ‚
- âœ… æ£€æµ‹ç±»åˆ«é€‰æ‹©

## ğŸ”§ APIæ¥å£

### Tauriå‘½ä»¤
```typescript
// åˆå§‹åŒ–YOLOæ¨¡å‹
await invoke('init_yolo_model', { modelPath: 'best.pt' });

// å›¾ç‰‡æ£€æµ‹
const result = await invoke('process_image', { imagePath: 'image.jpg' });

// æ‘„åƒå¤´æ£€æµ‹
await invoke('start_camera_detection', { deviceId: 0 });

// è§†é¢‘æ£€æµ‹
await invoke('start_video_detection', { videoPath: 'video.mp4' });

// è·å–ä¸‹ä¸€å¸§
const frame = await invoke('get_next_frame');

// åœæ­¢æ£€æµ‹
await invoke('stop_detection');

// æ›´æ–°ç½®ä¿¡åº¦é˜ˆå€¼
await invoke('update_confidence_threshold', { 
  className: 'person', 
  threshold: 0.7 
});

// è®¾ç½®æ£€æµ‹ç±»åˆ«
await invoke('set_selected_classes', { classIds: [0, 1, 2] });

// è·å–æ£€æµ‹çŠ¶æ€
const state = await invoke('get_detection_state');
```

### æ•°æ®ç»“æ„
```rust
// æ£€æµ‹ç»“æœ
pub struct DetectionResult {
    pub detections: Vec<YoloDetection>,
    pub frame_data: Option<String>, // base64å›¾åƒæ•°æ®
    pub timestamp: u64,
}

// æ£€æµ‹æ¡†ä¿¡æ¯
pub struct YoloDetection {
    pub class_id: u32,
    pub class_name: String,
    pub confidence: f32,
    pub bbox: BoundingBox,
}

// è¾¹ç•Œæ¡†
pub struct BoundingBox {
    pub x: f32,
    pub y: f32,
    pub width: f32,
    pub height: f32,
}
```

## âš¡ æ€§èƒ½ç‰¹ç‚¹

### ä¼˜åŠ¿
- **é«˜æ€§èƒ½**ï¼šRuståŸç”Ÿä»£ç  + Candleæ¨ç†ï¼Œæ¯”Pythonç‰ˆæœ¬å¿«30-50%
- **å†…å­˜å®‰å…¨**ï¼šé›¶è¿è¡Œæ—¶é”™è¯¯ï¼Œæ— å†…å­˜æ³„æ¼
- **å¹¶å‘å¤„ç†**ï¼šçœŸæ­£çš„å¼‚æ­¥å¹¶å‘ï¼Œæ— GILé™åˆ¶
- **ç³»ç»Ÿé›†æˆ**ï¼šåŸç”Ÿæ¡Œé¢åº”ç”¨ä½“éªŒ
- **èµ„æºæ•ˆç‡**ï¼šæ›´ä½çš„CPUå’Œå†…å­˜å ç”¨

### æ€§èƒ½å¯¹æ¯”ï¼ˆé¢„ä¼°ï¼‰
| åŠŸèƒ½ | Pythonç‰ˆæœ¬ | Rustç‰ˆæœ¬ | æå‡ |
|------|------------|----------|------|
| æ¨ç†é€Ÿåº¦ | 100ms | 60-70ms | 30-40% |
| å†…å­˜ä½¿ç”¨ | 500MB | 300-350MB | 30-40% |
| å¯åŠ¨æ—¶é—´ | 3-5s | 1-2s | 50-60% |
| å¹¶å‘èƒ½åŠ› | å—é™(GIL) | ä¼˜ç§€(åŸç”Ÿ) | æ˜¾è‘—æå‡ |

## ğŸ”® å‘å±•è·¯çº¿

### çŸ­æœŸè®¡åˆ’
- [ ] ä¼˜åŒ–YOLOæ¨ç†æ€§èƒ½
- [ ] æ·»åŠ GPUåŠ é€Ÿæ”¯æŒ
- [ ] å®Œå–„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- [ ] æ·»åŠ æ›´å¤šå›¾åƒæ ¼å¼æ”¯æŒ

### ä¸­æœŸè®¡åˆ’
- [ ] æ”¯æŒYOLOv9/YOLOv10æ¨¡å‹
- [ ] æ·»åŠ å¯¹è±¡è¿½è¸ªåŠŸèƒ½
- [ ] å®ç°æ‰¹é‡å›¾ç‰‡å¤„ç†
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§é¢æ¿

### é•¿æœŸè®¡åˆ’
- [ ] æ”¯æŒè‡ªå®šä¹‰æ¨¡å‹è®­ç»ƒ
- [ ] æ·»åŠ äº‘ç«¯æ¨¡å‹åŒæ­¥
- [ ] å®ç°åˆ†å¸ƒå¼æ£€æµ‹
- [ ] ç§»åŠ¨ç«¯é€‚é…ï¼ˆAndroid/iOSï¼‰

## ğŸ› å·²çŸ¥é—®é¢˜

1. **OpenCVå®‰è£…å¤æ‚**ï¼šè·¨å¹³å°ä¾èµ–ç®¡ç†å›°éš¾
   - è§£å†³æ–¹æ¡ˆï¼šæä¾›é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…æˆ–Dockeré•œåƒ

2. **æ¨¡å‹æ–‡ä»¶å¤§å°**ï¼šYOLOv8æ¨¡å‹æ–‡ä»¶è¾ƒå¤§ï¼ˆ50MB+ï¼‰
   - è§£å†³æ–¹æ¡ˆï¼šæ¨¡å‹é‡åŒ–æˆ–æŒ‰éœ€ä¸‹è½½

3. **ç¼–è¯‘æ—¶é—´é•¿**ï¼šCandleæ¡†æ¶ç¼–è¯‘è¾ƒæ…¢
   - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ç¼“å­˜å’Œå¢é‡ç¼–è¯‘

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### å¼€å‘ç¯å¢ƒ
- **æ¨è**ï¼šä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬è¿›è¡Œå¿«é€Ÿå¼€å‘å’Œæµ‹è¯•
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šå®‰è£…OpenCVè·å¾—å®Œæ•´åŠŸèƒ½

### æ€§èƒ½è°ƒä¼˜
```rust
// è°ƒæ•´å¸§ç‡æ§åˆ¶
tokio::time::sleep(tokio::time::Duration::from_millis(33)).await; // 30fps

// è°ƒæ•´ç»“æœé˜Ÿåˆ—å¤§å°
if state_lock.results.len() > 10 {
    state_lock.results.remove(0);
}
```

### é”™è¯¯å¤„ç†
```typescript
try {
  await invoke('start_camera_detection', { deviceId: 0 });
} catch (error) {
  if (error.includes('OpenCV')) {
    // æç¤ºç”¨æˆ·å®‰è£…OpenCVæˆ–ä½¿ç”¨Pythonç‰ˆæœ¬
  }
}
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **Pythonç‰ˆæœ¬**ï¼šåŠŸèƒ½å®Œæ•´ï¼Œæ¨èç”¨äºå¿«é€ŸåŸå‹å’Œæ¼”ç¤º
- **Rustç‰ˆæœ¬**ï¼šæ€§èƒ½ä¼˜åŒ–ï¼Œæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ
- **æ··åˆæ–¹æ¡ˆ**ï¼šå¯ä»¥åŒæ—¶éƒ¨ç½²ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒæŒ‰éœ€é€‰æ‹©

---

**ç»“è®º**ï¼šRustç‰ˆæœ¬å·²ç»å…·å¤‡äº†ä¸Pythonç‰ˆæœ¬ç›¸åŒçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œåœ¨æ€§èƒ½å’Œç¨³å®šæ€§æ–¹é¢æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚å¯¹äºè¿½æ±‚æè‡´æ€§èƒ½çš„åœºæ™¯ï¼Œæ¨èä½¿ç”¨Rustç‰ˆæœ¬ï¼›å¯¹äºå¿«é€Ÿå¼€å‘å’ŒåŸå‹éªŒè¯ï¼ŒPythonç‰ˆæœ¬ä»ç„¶æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚